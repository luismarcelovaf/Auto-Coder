<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 800">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4F46E5"/>
      <stop offset="100%" style="stop-color:#7C3AED"/>
    </linearGradient>
    <linearGradient id="agentGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B"/>
      <stop offset="100%" style="stop-color:#D97706"/>
    </linearGradient>
    <linearGradient id="providerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981"/>
      <stop offset="100%" style="stop-color:#059669"/>
    </linearGradient>
    <linearGradient id="toolsGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3B82F6"/>
      <stop offset="100%" style="stop-color:#2563EB"/>
    </linearGradient>
    <linearGradient id="stateGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8B5CF6"/>
      <stop offset="100%" style="stop-color:#7C3AED"/>
    </linearGradient>
    <linearGradient id="configGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#EC4899"/>
      <stop offset="100%" style="stop-color:#DB2777"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="3" flood-opacity="0.15"/>
    </filter>
    <marker id="arrow-gray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748B"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10B981"/>
    </marker>
    <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3B82F6"/>
    </marker>
    <marker id="arrow-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#8B5CF6"/>
    </marker>
    <marker id="arrow-cyan" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0EA5E9"/>
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#EF4444"/>
    </marker>
    <marker id="arrow-slate" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#475569"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="800" fill="#F8FAFC"/>

  <!-- Title -->
  <rect x="0" y="0" width="1400" height="55" fill="url(#headerGrad)"/>
  <text x="700" y="36" font-family="Segoe UI, Arial, sans-serif" font-size="26" font-weight="bold" fill="white" text-anchor="middle">Auto-Coder Architecture</text>

  <!-- ==================== ROW 1: User -> CLI -> Agent -> Provider -> Cloud ==================== -->

  <!-- User Icon -->
  <g transform="translate(50, 100)">
    <circle cx="40" cy="30" r="22" fill="#64748B"/>
    <ellipse cx="40" cy="80" rx="32" ry="22" fill="#64748B"/>
    <text x="40" y="120" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="#334155" text-anchor="middle">User</text>
  </g>

  <!-- Arrow: User to CLI -->
  <line x1="130" y1="150" x2="195" y2="150" stroke="#64748B" stroke-width="2.5" marker-end="url(#arrow-gray)"/>

  <!-- CLI/REPL Box -->
  <g filter="url(#shadow)">
    <rect x="210" y="95" width="180" height="110" rx="10" fill="white" stroke="#CBD5E1" stroke-width="2"/>
    <rect x="210" y="95" width="180" height="32" rx="10" fill="#64748B"/>
    <rect x="210" y="117" width="180" height="10" fill="#64748B"/>
    <text x="300" y="118" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">CLI / REPL</text>
    <text x="300" y="150" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#475569" text-anchor="middle">cli.py / repl.py</text>
    <text x="300" y="170" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">Interactive Terminal UI</text>
    <text x="300" y="188" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">Rich + prompt-toolkit</text>
  </g>

  <!-- Arrow: CLI to Agent -->
  <line x1="390" y1="150" x2="465" y2="150" stroke="#64748B" stroke-width="2.5" marker-end="url(#arrow-gray)"/>

  <!-- Agent Box (Central - larger) -->
  <g filter="url(#shadow)">
    <rect x="480" y="80" width="260" height="140" rx="12" fill="white" stroke="#D97706" stroke-width="3"/>
    <rect x="480" y="80" width="260" height="36" rx="12" fill="url(#agentGrad)"/>
    <rect x="480" y="106" width="260" height="10" fill="url(#agentGrad)"/>
    <text x="610" y="106" font-family="Segoe UI, Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">Agent</text>
    <text x="610" y="138" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#475569" text-anchor="middle">agent.py</text>
    <text x="610" y="160" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#78716C" text-anchor="middle">Core Agentic Loop:</text>
    <text x="610" y="178" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#78716C" text-anchor="middle">User → LLM → Tools → Repeat</text>
    <text x="610" y="205" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#B45309" text-anchor="middle">Orchestrates all components</text>
  </g>

  <!-- Arrow: Agent to Provider -->
  <line x1="740" y1="150" x2="815" y2="150" stroke="#10B981" stroke-width="2.5" marker-end="url(#arrow-green)"/>

  <!-- LLM Provider Box -->
  <g filter="url(#shadow)">
    <rect x="830" y="95" width="220" height="110" rx="10" fill="white" stroke="#059669" stroke-width="2"/>
    <rect x="830" y="95" width="220" height="32" rx="10" fill="url(#providerGrad)"/>
    <rect x="830" y="117" width="220" height="10" fill="url(#providerGrad)"/>
    <text x="940" y="118" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">LLM Provider</text>
    <text x="940" y="148" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#475569" text-anchor="middle">openai_compatible.py</text>
    <text x="940" y="168" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">Streaming SSE • httpx async</text>
    <text x="940" y="188" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">Correlation ID tracking</text>
  </g>

  <!-- Arrow: Provider to Cloud -->
  <line x1="1050" y1="150" x2="1125" y2="150" stroke="#0EA5E9" stroke-width="2.5" stroke-dasharray="6,4" marker-end="url(#arrow-cyan)"/>

  <!-- External LLM Cloud -->
  <g transform="translate(1140, 105)">
    <ellipse cx="70" cy="45" rx="65" ry="42" fill="#E0F2FE" stroke="#0EA5E9" stroke-width="2"/>
    <text x="70" y="40" font-family="Segoe UI, Arial, sans-serif" font-size="13" font-weight="bold" fill="#0369A1" text-anchor="middle">LLM API</text>
    <text x="70" y="58" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#0369A1" text-anchor="middle">OpenAI / Ollama</text>
  </g>

  <!-- ==================== ROW 2: State + Tools ==================== -->

  <!-- Dotted lines from bottom row to main components (drawn FIRST so they appear behind ALL boxes) -->
  <path d="M 220 520 L 220 470 L 240 455" stroke="#EC4899" stroke-width="1.5" stroke-dasharray="5,3" fill="none"/>
  <path d="M 440 540 L 440 510 L 610 225" stroke="#F472B6" stroke-width="1.5" stroke-dasharray="5,3" fill="none"/>
  <path d="M 660 540 L 660 510 L 350 375" stroke="#A78BFA" stroke-width="1.5" stroke-dasharray="5,3" fill="none"/>

  <!-- Arrow: Agent down to Tools -->
  <line x1="610" y1="220" x2="610" y2="285" stroke="#3B82F6" stroke-width="2.5" marker-end="url(#arrow-blue)"/>

  <!-- Arrow: Agent down-left to State -->
  <path d="M 520 220 L 520 255 L 280 255 L 280 285" stroke="#8B5CF6" stroke-width="2.5" fill="none" marker-end="url(#arrow-purple)"/>

  <!-- Conversation State Box -->
  <g filter="url(#shadow)">
    <rect x="130" y="300" width="220" height="150" rx="10" fill="white" stroke="#7C3AED" stroke-width="2"/>
    <rect x="130" y="300" width="220" height="32" rx="10" fill="url(#stateGrad)"/>
    <rect x="130" y="322" width="220" height="10" fill="url(#stateGrad)"/>
    <text x="240" y="323" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">Conversation State</text>
    <text x="240" y="355" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#475569" text-anchor="middle">conversation.py</text>
    <text x="240" y="380" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">Message history management</text>
    <text x="240" y="398" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">System prompt</text>
    <text x="240" y="416" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">Tool call / result tracking</text>
    <text x="240" y="436" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#7C3AED" text-anchor="middle">PROJECT.md context</text>
  </g>

  <!-- Tools Registry Box -->
  <g filter="url(#shadow)">
    <rect x="420" y="300" width="420" height="195" rx="10" fill="white" stroke="#2563EB" stroke-width="2"/>
    <rect x="420" y="300" width="420" height="32" rx="10" fill="url(#toolsGrad)"/>
    <rect x="420" y="322" width="420" height="10" fill="url(#toolsGrad)"/>
    <text x="630" y="323" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">Tool Registry</text>
    <text x="630" y="350" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#64748B" text-anchor="middle">registry.py - Sync/async tool execution</text>

    <!-- filesystem.py tools -->
    <rect x="435" y="365" width="175" height="115" rx="6" fill="#EFF6FF" stroke="#BFDBFE" stroke-width="1"/>
    <text x="522" y="383" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="#1E40AF" text-anchor="middle">filesystem.py</text>
    <text x="448" y="403" font-family="Consolas, monospace" font-size="10" fill="#3B82F6">read_file</text>
    <text x="448" y="419" font-family="Consolas, monospace" font-size="10" fill="#3B82F6">write_file</text>
    <text x="448" y="435" font-family="Consolas, monospace" font-size="10" fill="#3B82F6">edit_file</text>
    <text x="540" y="403" font-family="Consolas, monospace" font-size="10" fill="#3B82F6">search_files</text>
    <text x="540" y="419" font-family="Consolas, monospace" font-size="10" fill="#3B82F6">list_directory</text>
    <text x="540" y="435" font-family="Consolas, monospace" font-size="10" fill="#3B82F6">delete_file</text>
    <text x="522" y="468" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#64748B" text-anchor="middle">Path sandboxing supported</text>

    <!-- shell.py tools -->
    <rect x="625" y="365" width="200" height="115" rx="6" fill="#ECFDF5" stroke="#A7F3D0" stroke-width="1"/>
    <text x="725" y="383" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="#065F46" text-anchor="middle">shell.py</text>
    <text x="725" y="410" font-family="Consolas, monospace" font-size="11" fill="#10B981" text-anchor="middle">run_command</text>
    <text x="725" y="432" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#64748B" text-anchor="middle">bash (Unix) / cmd (Win)</text>
    <text x="725" y="450" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#64748B" text-anchor="middle">Async with timeout</text>
    <text x="725" y="468" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#64748B" text-anchor="middle">Output truncation</text>
  </g>

  <!-- Arrow: Tools to Files -->
  <line x1="840" y1="400" x2="905" y2="400" stroke="#EF4444" stroke-width="2.5" marker-end="url(#arrow-red)"/>

  <!-- Filesystem Icon -->
  <g filter="url(#shadow)">
    <rect x="920" y="330" width="100" height="120" rx="8" fill="#FEF2F2" stroke="#FECACA" stroke-width="2"/>
    <rect x="935" y="350" width="70" height="10" rx="2" fill="#FCA5A5"/>
    <rect x="935" y="368" width="70" height="10" rx="2" fill="#FCA5A5"/>
    <rect x="935" y="386" width="50" height="10" rx="2" fill="#FCA5A5"/>
    <text x="970" y="420" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="#991B1B" text-anchor="middle">Local</text>
    <text x="970" y="436" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold" fill="#991B1B" text-anchor="middle">Files</text>
  </g>

  <!-- Arrow: Tools to Terminal -->
  <line x1="840" y1="460" x2="905" y2="510" stroke="#475569" stroke-width="2.5" marker-end="url(#arrow-slate)"/>

  <!-- Terminal Icon -->
  <g filter="url(#shadow)">
    <rect x="920" y="480" width="100" height="100" rx="8" fill="#1E293B" stroke="#475569" stroke-width="2"/>
    <text x="935" y="510" font-family="Consolas, monospace" font-size="11" fill="#22C55E">$_</text>
    <text x="935" y="530" font-family="Consolas, monospace" font-size="9" fill="#94A3B8">npm run</text>
    <text x="935" y="546" font-family="Consolas, monospace" font-size="9" fill="#94A3B8">git status</text>
    <text x="970" y="570" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold" fill="white" text-anchor="middle">Shell</text>
  </g>

  <!-- ==================== ROW 3: Config + Auth + Project ==================== -->

  <!-- Config Box -->
  <g filter="url(#shadow)">
    <rect x="130" y="520" width="180" height="130" rx="10" fill="white" stroke="#DB2777" stroke-width="2"/>
    <rect x="130" y="520" width="180" height="32" rx="10" fill="url(#configGrad)"/>
    <rect x="130" y="542" width="180" height="10" fill="url(#configGrad)"/>
    <text x="220" y="543" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">Configuration</text>
    <text x="220" y="575" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#475569" text-anchor="middle">config.py</text>
    <text x="220" y="600" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">.auto-coder.yaml</text>
    <text x="220" y="618" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">Environment variables</text>
    <text x="220" y="638" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">base_url, model, api_key</text>
  </g>

  <!-- Auth Box -->
  <g filter="url(#shadow)">
    <rect x="350" y="540" width="180" height="110" rx="10" fill="white" stroke="#F472B6" stroke-width="2"/>
    <rect x="350" y="540" width="180" height="32" rx="10" fill="#F472B6"/>
    <rect x="350" y="562" width="180" height="10" fill="#F472B6"/>
    <text x="440" y="563" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">Authentication</text>
    <text x="440" y="590" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#475569" text-anchor="middle">auth.py</text>
    <text x="440" y="615" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">SSO / API Key / Basic</text>
    <text x="440" y="633" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">certifi certificates</text>
  </g>

  <!-- Project Context Box -->
  <g filter="url(#shadow)">
    <rect x="570" y="540" width="180" height="110" rx="10" fill="white" stroke="#A78BFA" stroke-width="2"/>
    <rect x="570" y="540" width="180" height="32" rx="10" fill="#A78BFA"/>
    <rect x="570" y="562" width="180" height="10" fill="#A78BFA"/>
    <text x="660" y="563" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle">Project Context</text>
    <text x="660" y="590" font-family="Segoe UI, Arial, sans-serif" font-size="11" fill="#475569" text-anchor="middle">project.py</text>
    <text x="660" y="615" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">PROJECT.md generation</text>
    <text x="660" y="633" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">Chunked LLM analysis</text>
  </g>

  <!-- ==================== Legend ==================== -->
  <g transform="translate(1100, 300)">
    <rect x="0" y="0" width="200" height="160" rx="10" fill="white" stroke="#E2E8F0" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="100" y="25" font-family="Segoe UI, Arial, sans-serif" font-size="13" font-weight="bold" fill="#334155" text-anchor="middle">Legend</text>

    <line x1="20" y1="50" x2="60" y2="50" stroke="#64748B" stroke-width="2.5"/>
    <polygon points="60,46 70,50 60,54" fill="#64748B"/>
    <text x="85" y="54" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#64748B">Primary flow</text>

    <line x1="20" y1="75" x2="60" y2="75" stroke="#0EA5E9" stroke-width="2.5" stroke-dasharray="6,4"/>
    <polygon points="60,71 70,75 60,79" fill="#0EA5E9"/>
    <text x="85" y="79" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#64748B">External API</text>

    <line x1="20" y1="100" x2="60" y2="100" stroke="#EC4899" stroke-width="1.5" stroke-dasharray="5,3"/>
    <text x="85" y="104" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#64748B">Config/Context</text>

    <line x1="15" y1="125" x2="185" y2="125" stroke="#E2E8F0" stroke-width="1"/>
    <text x="100" y="145" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#64748B" text-anchor="middle">Python 3.10+ • httpx • rich</text>
  </g>

  <!-- Version badge -->
  <g transform="translate(1250, 750)">
    <rect x="0" y="0" width="70" height="24" rx="12" fill="#E2E8F0"/>
    <text x="35" y="16" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#64748B" text-anchor="middle">v0.1.0</text>
  </g>
</svg>